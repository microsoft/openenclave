Libcxxrt tests
=============

This directory run libcxxrt tests in an enclave enviornment. It does
this by repeatedly building and running the enclave located under the 'enc' 
directory for each unit test found in tests.supported.

The unit tests are partitioned into three files:

* tests.supported -- unit tests that work
* tests.unsupported -- unit tests that are not supported

To run all the tests, type the following command:

```
# make tests
```

As tests are fixed, they should be moved from tests.broken to tests.supported.

As tests are determined to be unsupportable, they should be moved from
tests.broken to tests.unsupported.

Note
====

libcxxrt basically contains two tests:

  1. test_foreign_exceptions.cc

In case of test_foreign_exception, it is tested using the return value from
the main() function and  hence conclude whether test is success or failure.

  2. test.cc (contains test_guard.cc, test_typeinfo.cc and test_exception.cc)

In case of test.cpp, the main(), which is of void type, will generate a
sequence of test logs  regarding test_guard, test_typeinfo and test_exception.

Test is compiled in two different ways, one using **libcxxrt** and the other
using standard system depended libraries (i.e., it will use **libsupcxx** ABI
library instead of libcxxrt), and then generate two different log files which
is then compared to see, whether the test passes or not. If the two generated
log files are identical, then the test mark as pass, otherwise fail.

In our enclave case, we have done some modifications from above.

* Seperated test_guard.cpp, test_typeinfo.cpp, and test_exception.cpp from
  test.cpp

Inorder to have a better hold on each tests, we have seperated out test_guard,
test_typeinfo and test_exception tests from test.cc

* Changed the comparison mechanism in test.cc

Here, we are compiling each test (test_guard.cc, test_typeinfo.cc and
test_exception.cc) against **libcxxrt with enclave libraries** as well as
**libcxxrt with system dependent libraries** and comparing each logs generated
by these two test scenarios. Depending upon whether the test logs are identical
or not, test is considered to be passed or failed. *Since our tests are dependend
on generated logs, we can't add any additional prints in any files (eg: enc.cpp,
host.cpp), which will result in log mismatch between what created by enclave
with what generated by system.*

The reason why we used above comparison method is test_exception.cc requires
std::uncaught_exceptions(), which is supported by clang 3.8, or gcc version 6
or above, inorder to compile test against system dependend libraries. Currently
our enclave support gcc version upto 5.
