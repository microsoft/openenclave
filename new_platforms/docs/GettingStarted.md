Getting Started with Open Enclave: TrustZone and SGX
=========================================

**Note**: We have migrated the build system to CMake and are in the process of
updating the documentation accordingly. For the moment, refer to the following
summary.

## On Windows

- Install [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/)  
  In the Visual Studio Installer, select:
  - Workloads:
    - Desktop development with C++
  - Individual components:
    - VC++ 2017 version 15.9 v14.19 Libs for Spectre (ARM)
    - VC++ 2017 version 15.9 v14.19 Libs for Spectre (x86 and x64)
    - Visual C++ tools for CMake
    - Windows 10 SDK (10.0.16299 or later)
  - The installer may automatically select dependent items.
- For Intel SGX
  - Intel SGX SDK
  - Intel SGX PSW (for SGX-capable machines)
  - Both available [from Intel](https://software.intel.com/en-us/sgx-sdk/download).
- For ARM TrustZone
  - [Windows 10 WDK](https://docs.microsoft.com/en-us/windows-hardware/drivers/download-the-wdk)
  
**Note**: The version of the Windows 10 WDK you install must match the version
of the latest Windows 10 SDK installed on the system. If you require a WDK
version prior to the latest, these are available
[here](https://docs.microsoft.com/en-us/windows-hardware/drivers/other-wdk-downloads).

After cloning, open Visual Studio 2017 and use File -> Open -> CMake...,
then select the `CMakeLists.txt` file under `new_platforms`.
Select a build configuration from the configuration drop-down in the toolbar
and wait while CMake processes the configuration for the first time.
Once the initial configuration is done, select CMake -> Build All.

To debug ARM simulation builds, select the desired host app from the drop-down
that lists all the available debug targets. It is located to the right of the
configurations drop-down. Then, either run the host app or use the options
under the Debug menu.

To debug Intel SGX enclaves (hardware or simulated), open a new instance of
Visual Studio 2017 and open the solution that CMake automatically generated
for the build configuration you selected earlier. It will be located under
`%USERPROFILE%\<workspacehash>\build\<configuration>`. In the Solution
Explorer, find the project corresponding to the host app whose enclave you
want to debug, right-click on it and select Properties. In the properties dialog,
select "Debugging" in the left-hand tree and change the debugger to "Intel(R) SGX Debugger".
Then set the working directory to the path where the host app binary is located.

**Note**: The autogenerated solution and its projects may be regenerated if any
of the `CMakeLists.txt` files change.

For example, if you built the `x86-SGX-Debug` configuration, the solution file
will be located under:

`%USERPROFILE%\<workspacehash>\build\x86-SGX-Debug\Open Enclave SDK (New Platforms).sln`

and the host app for the test suite, for instance, will be under:

`%USERPROFILE%\<workspacehash>\build\x86-SGX-Debug\out\bin\Debug`

## On Linux

Follow the steps for [Linux & ARM TrustZone](linux_arm_dev.md).

# Getting Started

This getting started guide includes preview support for new Trusted Execution Environment (TEE) platforms:

* ARM TrustZone with a Linux Host Application
* Intel SGX with a Windows Host Application

Support for a Windows Host application on ARM TrustZone and native Open Enclave support for Windows SGX will be added in the future.

In addition, this preview includes support for testing your enclave under simulation when developing on Windows and Linux. 

For a Linux Host application on SGX, see the Linux SGX Open Enclave [Getting Started](../../docs/GettingStartedDocs/GettingStarted.md) guide.

## Multi-Platform Support

The main goal of the Open Enclave SDK is to provide a single API surface that works across multiple platforms.
With the addition of ARM TrustZone Trusted Applications (TA's) as a supported platform
you can write a single Enclave and Host application,
then build and run the Enclave as an SGX Enclave or a TrustZone TA. 
For under-the-cover details on the differences between SGX and ARM TrustZone, see [Understanding SGX and TrustZone](sgx_trustzone_arch.md).

## Development Environment

This SDK supports developing your Enclave and Host application on either a Windows or a Linux development environment. 
The selection of your development environment should be guided by the Rich Execution Environment (REE) the host application will be running on. 

If you want to dive right in, use the table below.

| REE     | TEE                                                                  |
| ------- | :------------------------------------------------------------------- |
| Linux   | [ARM TrustZone](linux_arm_dev.md)                                    |
| Linux   | [Emulated ARM TrustZone (OP-TEE)](ta_debugging_qemu.md)              |
| Windows | [Intel SGX](win_sgx_dev.md)                                          |
| Windows | [Simulated SGX](win_sgx_dev.md#sgx-simulation)                       |
| Windows | [Simulated ARM TrustZone (OP-TEE)](win_sgx_dev.md#op-tee-simulation) |

## Linux Host Application and ARM TrustZone TA

ARM TrustZone TA support currently targets the Scalys Grapeboard, based on the NXP Layerscape LS1012A, as a reference platform. 
This reference platform runs OP-TEE to support ARM TrustZone TAs. For more details, see the links below: 

* [Getting Started with the Grapeboard](grapeboard.md)
* [Building an Open Enclave TrustZone TA on Linux](linux_arm_dev.md)
* [Running the Sample Client on the Grapeboard](sample_sockets.md#building-for-grapeboard)

## Linux Host Application and ARM TrustZone Emulation

QEMU provides an emulated ARM TrustZone environment to debug your REE and TEE
code that faithfully reproduces the dynamics of real ARM TrustZone-capable
hardware. You can use GDB or any GDB-compatible GUI to debug your code.

* [Debugging OP-TEE TAs with QEMU](ta_debugging_qemu.md)

## Windows Host Application and SGX Enclave (Intel SDK Required)

Windows SGX Enclave support works on any device with a SGX-capable processor.
To find out if your processor supports SGX, consult [Intel ARK](https://ark.inte.com). An example device with such support is the NUC7i3BNK.

* [Building an Open Enclave SGX Enclave on Windows](win_sgx_dev.md)
* [Running the Sample Server on SGX](sample_sockets.md#building-for-sgx)

## Windows Host Application with SGX and OP-TEE Simulation

Simulation provides a development environment to quickly write, test, and debug your REE and TEE code. 
This SDK provides simulation support for SGX using Intel Simulation SDK and for TrustZone using OP-TEE simulation.
Both environments can be debugged using Visual Studio.

* [Building an Open Enclave Simulation on Windows](win_sgx_dev.md#simulation)
* [Simulating the Sample Server and Client](sample_sockets.md#building-for-simulation)

## Multi-Platform Sample

Running through the steps above will produce enclaves for both SGX and ARM using the same Open Enclave sample code.
To demonstrate how these samples can come together and provide TEE to TEE communication, see the [IoTEdge Socket Sample](sample_edge_sockets.md).

## Beyond the Samples
* [Open Enclave API Documentation](openenclaveapi.md)
* [Developing your own enclave using Visual Studio](visualstudio_dev.md)
* [Developing your own enclave using CMake](new_platform_dev.md)
* [Understanding SGX and TrustZone](sgx_trustzone_arch.md)

